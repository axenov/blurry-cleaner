<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="360" viewBox="0 0 1000 360">
  <defs>
    <style>
      .box { fill: #0f1522; stroke: #2d364b; stroke-width: 2; rx: 14; ry: 14; }
      .text { font: 15px 'Segoe UI', sans-serif; fill: #e8eefc; }
      .small { font: 12px 'Segoe UI', sans-serif; fill: #9ab0cf; }
      .arrow { stroke: #7bdcfb; stroke-width: 3; marker-end: url(#arrowHead); }
    </style>
    <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="6" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L6,3 z" fill="#7bdcfb"/>
    </marker>
  </defs>

  <rect x="30" y="40" width="190" height="120" class="box"/>
  <text x="50" y="80" class="text">Input image</text>
  <text x="50" y="105" class="small">File buffer (≤30 MB)</text>
  <text x="50" y="125" class="small">Clamp max side 640 px</text>

  <rect x="245" y="40" width="190" height="120" class="box"/>
  <text x="265" y="80" class="text">Preprocess</text>
  <text x="265" y="105" class="small">Grayscale Y = 0.299R+0.587G+0.114B</text>
  <text x="265" y="125" class="small">Mean μ, std σ</text>

  <rect x="460" y="40" width="210" height="120" class="box"/>
  <text x="480" y="75" class="text">Sharpness</text>
  <text x="480" y="100" class="small">Laplacian kernel [0 1 0; 1 −4 1; 0 1 0]</text>
  <text x="480" y="120" class="small">Var(∇²I) → S</text>

  <rect x="690" y="40" width="260" height="120" class="box"/>
  <text x="710" y="75" class="text">Noise &amp; brightness</text>
  <text x="710" y="100" class="small">Neighbour MAD → N</text>
  <text x="710" y="120" class="small">Brightness drift |μ−128|/128 → B</text>

  <line x1="220" y1="100" x2="245" y2="100" class="arrow"/>
  <line x1="435" y1="100" x2="460" y2="100" class="arrow"/>
  <line x1="670" y1="100" x2="690" y2="100" class="arrow"/>

  <rect x="240" y="210" width="470" height="110" class="box"/>
  <text x="260" y="250" class="text">Quality fusion</text>
  <text x="260" y="275" class="small">Q = clip(0,100, 0.65·S + 0.25·C − 0.20·N − 0.05·B + 10)</text>

  <line x1="560" y1="160" x2="560" y2="210" class="arrow"/>

  <rect x="740" y="210" width="200" height="110" class="box"/>
  <text x="760" y="250" class="text">Decision</text>
  <text x="760" y="275" class="small">if Q &lt; τ → flag / auto-select</text>
  <text x="760" y="295" class="small">τ user-set (default 42)</text>
</svg>
